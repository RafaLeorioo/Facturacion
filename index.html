<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Formulario de FacturaciÃ³n</title>
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: #ffffff;
      margin: 0;
      padding: 0;
      height: 100vh;
    }
    .container {
      background-color: #ffffff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
      text-align: center;
      max-width: 500px;
      width: 90%;
      margin: 0 auto;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      transition: transform 0.3s ease;
    }
    .container:hover {
      transform: translateY(-5px);
    }
    h2 {
      color: #333;
      margin-bottom: 20px;
      font-size: 24px;
      font-weight: 500;
    }
    form {
      width: 100%;
    }
    .form-row {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      margin-bottom: 6px;
      width: 100%;
    }
    label {
      color: #555;
      font-size: 14px;
      font-weight: 500;
      width: 130px;
      text-align: right;
      padding-right: 5px;
    }
    input[type="text"],
    input[type="number"] {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      width: 100%;
      max-width: 200px;
      font-size: 14px;
      box-sizing: border-box;
      transition: border-color 0.3s ease;
    }
    input[type="text"]:focus,
    input[type="number"]:focus {
      border-color: #4caf50;
      outline: none;
    }
    input[readonly] {
      background-color: #f9f9f9;
      cursor: not-allowed;
    }
    .output {
      margin-top: 25px;
      font-size: 16px;
      text-align: left;
      color: #333;
    }
    .output ul {
      list-style-type: none;
      padding: 0;
    }
    .output li {
      margin: 8px 0;
      font-size: 15px;
    }
    button {
      margin: 12px 6px;
      padding: 10px 20px;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background-color 0.3s ease, transform 0.2s ease;
      touch-action: manipulation;
    }
    button:hover {
      background-color: #45a049;
      transform: scale(1.05);
    }
    .option-buttons {
      display: flex;
      flex-direction: row;
      justify-content: center;
      gap: 12px;
      margin: 15px 0;
      flex-wrap: wrap;
    }
    .option-buttons button {
      background-color: #2196f3;
    }
    .option-buttons button:hover {
      background-color: #1976d2;
    }
    .extra-line.dana {
      color: #1e90ff;
      font-style: italic;
    }
    .extra-line.cole {
      color: #228b22;
      font-style: italic;
    }
    .copied,
    .error {
      font-size: 14px;
      margin-top: 10px;
      display: none;
    }
    .copied {
      color: #4caf50;
    }
    .error {
      color: #e53935;
    }

    @media (max-width: 600px) {
      .form-row {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 6px;
      }
      label {
        width: 140px;
      }
      input[type="text"],
      input[type="number"] {
        width: calc(100% - 150px);
      }
    }

    @media (max-width: 400px) {
      .container {
        padding: 15px;
      }
      h2 {
        font-size: 18px;
      }
      .option-buttons button,
      button {
        max-width: 150px;
      }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet"/>
</head>
<body>
  <div class="container">
    <h2>Formulario de FacturaciÃ³n</h2>
    <form id="facturaForm">
      <div class="form-row">
        <label for="colegio">Colegio:</label>
        <input type="text" id="colegio" />
      </div>
      <div class="form-row">
        <label for="facturado">Ha facturado:</label>
        <input type="number" id="facturado" step="0.01" min="0" />
      </div>
      <div class="form-row">
        <label for="separadores">Separadores:</label>
        <input type="number" id="separadores" step="1" min="0" />
      </div>
      <div class="form-row">
        <label for="resultado">Monto Final:</label>
        <input type="text" id="resultado" readonly />
      </div>
      <div class="form-row">
        <label for="porcentaje">5%:</label>
        <input type="text" id="porcentaje" readonly />
      </div>
    </form>
    <div class="option-buttons">
      <button type="button" onclick="selectOption('dana')">Dana</button>
      <button type="button" onclick="selectOption('cole')">Cole</button>
    </div>
    <div class="output" id="output">
      Introduce los datos en los campos para ver el resultado.
    </div>
    <button type="button" onclick="copyText()">Copiar Texto</button>
    <div class="copied" id="copiedMessage">Â¡Texto copiado!</div>
    <div class="error" id="errorMessage">Error al copiar el texto.</div>
  </div>

  <script>
    const form = document.getElementById('facturaForm');
    const output = document.getElementById('output');
    const facturadoInput = document.getElementById('facturado');
    const separadoresInput = document.getElementById('separadores');
    const resultadoInput = document.getElementById('resultado');
    const porcentajeInput = document.getElementById('porcentaje');
    const copiedMessage = document.getElementById('copiedMessage');
    const errorMessage = document.getElementById('errorMessage');
    let selectedOption = null;

    function updateOutput() {
      const colegio = document.getElementById('colegio').value;
      const facturado = facturadoInput.value;
      const separadores = separadoresInput.value;
      const resultado = resultadoInput.value;
      const porcentaje = porcentajeInput.value;

      let extraLine = '';
      if (selectedOption === 'dana') {
        extraLine = '<li class="extra-line dana">ðŸ’§ Donado a colegios afectados por DANA</li>';
      } else if (selectedOption === 'cole') {
        extraLine = '<li class="extra-line cole">ðŸŽ“ Destinado al bono del cole</li>';
      }

      let listItems = '';
      if (colegio) listItems += `<li>Colegio: <strong>${colegio}</strong></li>`;
      if (facturado) listItems += `<li>Ha facturado: <strong>${facturado}</strong>â‚¬</li>`;
      if (separadores) listItems += `<li>Separadores: <strong>${separadores}</strong></li>`;
      if (resultado) listItems += `<li>Monto Final: <strong>${resultado}</strong>â‚¬</li>`;
      if (porcentaje) listItems += `<li>5% del monto final: <strong>${porcentaje}</strong>â‚¬</li>`;

      output.innerHTML = listItems || 'Introduce los datos en los campos para ver el resultado.';
      if (listItems) {
        output.innerHTML = `<ul>${listItems}${extraLine}</ul>`;
      }
    }

    form.addEventListener('input', () => {
      const facturado = parseFloat(facturadoInput.value) || 0;
      const separadores = parseInt(separadoresInput.value) || 0;
      const resultado = facturado - separadores;
      resultadoInput.value = isNaN(resultado) ? '' : resultado.toFixed(2);
      const porcentaje = resultado * 0.05;
      porcentajeInput.value = isNaN(porcentaje) ? '' : porcentaje.toFixed(2);
      updateOutput();
    });

    function selectOption(option) {
      selectedOption = option;
      updateOutput();
    }

    function copyText() {
      const colegio = document.getElementById('colegio').value;
      const facturado = facturadoInput.value;
      const separadores = separadoresInput.value;
      const resultado = resultadoInput.value;
      const porcentaje = porcentajeInput.value;

      let lines = [];
      if (colegio) lines.push(`Colegio: ${colegio}`);
      if (facturado) lines.push(`Ha facturado: ${facturado}â‚¬`);
      if (separadores) lines.push(`Separadores: ${separadores}`);
      if (resultado) lines.push(`Monto Final: ${resultado}â‚¬`);
      if (porcentaje) lines.push(`5% del monto final: ${porcentaje}â‚¬`);

      if (selectedOption === 'dana') {
        lines.push('ðŸ’§ Donado a colegios afectados por DANA');
      } else if (selectedOption === 'cole') {
        lines.push('ðŸŽ“ Destinado al bono del cole');
      }

      const textToCopy = lines.join('\n');

      if (navigator.clipboard) {
        navigator.clipboard.writeText(textToCopy).then(() => {
          showMessage(copiedMessage);
        }).catch(err => {
          console.error('Error al copiar con navigator.clipboard: ', err);
          fallbackCopyText(textToCopy);
        });
      } else {
        fallbackCopyText(textToCopy);
      }
    }

    function fallbackCopyText(text) {
      try {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.opacity = '0';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showMessage(copiedMessage);
      } catch (err) {
        console.error('Error al copiar con mÃ©todo alternativo: ', err);
        showMessage(errorMessage);
      }
    }

    function showMessage(messageElement) {
      messageElement.style.display = 'block';
      setTimeout(() => {
        messageElement.style.display = 'none';
      }, 2000);
    }

    updateOutput();
  </script>
</body>
</html>
