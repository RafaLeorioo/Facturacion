<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Editor de Mensaje</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #e3f2fd, #fff);
      padding: 30px;
    }
    .container {
      background-color: #ffffff;
      padding: 30px;
      border-radius: 16px;
      max-width: 520px;
      margin: 0 auto;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
      animation: fadeIn 0.4s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    h2 {
      text-align: center;
      margin-bottom: 25px;
      color: #0d47a1;
      font-size: 24px;
      font-weight: 700;
    }
    .field-group {
      margin-bottom: 20px;
    }
    .field-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #333;
    }
    .field-group input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #b0bec5;
      border-radius: 8px;
      font-size: 15px;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .field-group input:focus {
      border-color: #1976d2;
      box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.25);
      outline: none;
    }
    .field-group input:invalid {
      border-color: #e53935;
    }
    button {
      width: 100%;
      padding: 12px;
      font-size: 17px;
      background-color: #1976d2;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      margin-top: 10px;
      transition: background 0.2s, transform 0.1s;
    }
    button:hover {
      background-color: #0d47a1;
    }
    button:active {
      transform: scale(0.98);
    }
    .resultado {
      margin-top: 25px;
      padding: 15px;
      background-color: #e8f1ff;
      border-radius: 10px;
      border-left: 5px solid #1976d2;
      color: #0d47a1;
      font-size: 15px;
      min-height: 40px;
      white-space: pre-wrap;
    }
    .nota {
      color: #555;
      font-size: 13px;
      margin-top: -10px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

  <div class="container">
    <h2>Cupón feria</h2>

    <div class="field-group">
      <label for="oportunidad">Oportunidad:</label>
      <input type="text" id="oportunidad" placeholder="Nombre del colegio" />
    </div>

    <div class="field-group">
      <label for="provincia">Provincia:</label>
      <input type="text" id="provincia" placeholder="Provincia" />
    </div>

    <div class="field-group">
      <label for="facturacion">Facturación total del centro (€):</label>
      <input type="number" id="facturacion" min="0" step="0.01" placeholder="Importe facturado" />
    </div>

    <div class="field-group" style="display:flex; gap:10px;">
      <button type="button" id="btn5">5%</button>
      <button type="button" id="btn10">10%</button>
    </div>

    <div class="field-group nota">
      Al pinchar estos botones, el resultado que se muestre debajo estará sin IVA (ya se ha dividido por 1.04).
    </div>

    <div class="field-group">
      <label for="cupon_sin_iva">Resultado sin IVA (€):</label>
      <input type="number" id="cupon_sin_iva" readonly />
    </div>

    <div class="field-group">
      <label for="telefono">Tlf. Contacto:</label>
      <input type="tel" id="telefono" pattern="[0-9+]*" placeholder="Número de teléfono" />
    </div>

    <div class="field-group">
      <label for="nombre">Nombre contacto:</label>
      <input type="text" id="nombre" placeholder="Nombre" />
    </div>

    <button id="copiarBtn">Copiar mensaje</button>

    <div class="resultado" id="resultado"></div>
  </div>

  <script>
    const oportunidadInput = document.getElementById('oportunidad');
    const provinciaInput = document.getElementById('provincia');
    const facturacionInput = document.getElementById('facturacion');
    const btn5 = document.getElementById('btn5');
    const btn10 = document.getElementById('btn10');
    const cuponSinIVA = document.getElementById('cupon_sin_iva');
    const telefonoInput = document.getElementById('telefono');
    const nombreInput = document.getElementById('nombre');
    const copiarBtn = document.getElementById('copiarBtn');
    const resultadoDiv = document.getElementById('resultado');

    function aplicarPorcentaje(porcentaje) {
      const fact = parseFloat(facturacionInput.value);
      if (!isNaN(fact) && fact > 0) {
        const resultado = (fact * porcentaje / 100) / 1.04;
        cuponSinIVA.value = resultado.toFixed(2);
        resultadoDiv.textContent = generarMensaje();
      } else {
        alert('Introduce un importe de facturación válido');
      }
    }

    btn5.addEventListener('click', () => aplicarPorcentaje(5));
    btn10.addEventListener('click', () => aplicarPorcentaje(10));

    function generarMensaje() {
      const encabezado = "Canje de cupón feria online";
      const oportunidad = oportunidadInput.value.trim();
      const provincia = provinciaInput.value.trim();
      const cupon = cuponSinIVA.value.trim();
      const telefono = telefonoInput.value.trim();
      const nombre = nombreInput.value.trim();

      let oportunidadFinal = oportunidad;
      if (provincia) oportunidadFinal += ` - ${provincia}`;

      return `${encabezado}
------------------------------
Oportunidad: ${oportunidadFinal}
Cupón feria disponible: ${cupon} €
Tlf. Contacto: ${telefono} - ${nombre}`;
    }

    function copiarAlPortapapeles(texto) {
      navigator.clipboard.writeText(texto)
        .then(() => {
          resultadoDiv.textContent = "Mensaje copiado al portapapeles:\n\n" + texto;
        })
        .catch(err => {
          resultadoDiv.textContent = "Error al copiar: " + err;
        });
    }

    copiarBtn.addEventListener('click', () => {
      if (cuponSinIVA.validity.badInput || telefonoInput.validity.patternMismatch) {
        resultadoDiv.textContent = "Por favor, introduce valores válidos en los campos.";
        return;
      }
      const mensaje = generarMensaje();
      copiarAlPortapapeles(mensaje);
    });

    [oportunidadInput, provinciaInput, cuponSinIVA, telefonoInput, nombreInput].forEach(el => {
      el.addEventListener('input', () => { resultadoDiv.textContent = generarMensaje(); });
    });

    resultadoDiv.textContent = "";
  </script>

</body>
</html>
